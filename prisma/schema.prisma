generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id String @id @default(uuid())
  name  String
  email String @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  visits Visit[]
  staff Staff[]
  authCredentials UserCredential[]
  systemCredentials SystemCredential[]
}

model Visit {
  id  String @id @default(uuid())
  orgId   String
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  fullName  String
  visitorOrganization  String
  email  String
  reasonOfVisit String
  staffId String
  staff Staff @relation(fields: [staffId], references: [id], onDelete: Cascade)
  startTime DateTime @default(now())
  endTime DateTime?
  status  MeetingStatus @default(ONGOING)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt  
}

model Staff {
  id String @id @default(uuid())
  orgId String
  organization  Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  userId String?  @unique
  userCredential UserCredential? @relation("StaffAuth", fields: [userId], references: [id], onDelete: Cascade)
  name  String  
  email String  @unique
  designation String 
  department  String
  role MemberRoleEnum @default(Staff)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  visits Visit[]
}

model RefreshToken {
  id  String @id @default(uuid())
  token String @unique
  userId  String?
  userCredentials UserCredential? @relation(fields: [userId], references: [id], onDelete: Cascade)
  systemId  String?
  systemCredentials SystemCredential? @relation(fields: [systemId], references: [id], onDelete: Cascade)
  expiryDate  DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}


model UserCredential{
  id String @id @default(uuid())
  orgId String?
  organization  Organization? @relation(fields: [orgId],references: [id], onDelete: Cascade)
  email String @unique
  password  String
  role AuthRoleEnum
  firstTimeLogin  Boolean? @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  staff    Staff?  @relation("StaffAuth")
  refreshToken RefreshToken[]
}

model SystemCredential {
  id String @id @default(uuid())
  orgId String
  organization  Organization @relation(fields: [orgId],references: [id], onDelete: Cascade)
  email String @unique
  password  String
  role String @default("System")
  refreshToken  RefreshToken[]
}


enum MeetingStatus {
  ONGOING
  COMPLETED
}

enum AuthRoleEnum {
  Root
  SuperAdmin
  Admin
}

enum MemberRoleEnum {
  SuperAdmin
  Admin
  Staff
}