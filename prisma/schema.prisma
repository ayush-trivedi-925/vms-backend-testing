generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id String @id @default(uuid())
  logo String?
  name  String
  email String @unique
  address String
  contactNumber String
  contactPerson String
  gst String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  visits Visit[]
  staff Staff[]
  authCredentials UserCredential[]
  systemCredentials SystemCredential[]
  departments Department[]
  reasonOfVisits  ReasonOfVisit[]
}

model Visit {
  id  String @id @default(uuid())
  orgId   String
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  fullName  String
  visitorOrganization  String
  email  String
  reasonId  String?
  reasonOfVisit ReasonOfVisit? @relation(fields: [reasonId], references: [id])
  staffId String
  staff Staff @relation(fields: [staffId], references: [id], onDelete: Cascade)
  startTime DateTime @default(now())
  endTime DateTime?
  status  MeetingStatus @default(ONGOING)
  checkInPicture  String? 
  checkOutPicture String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt  
}

model Staff {
  id String @id @default(uuid())
  orgId String
  organization  Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  userId String?  @unique
  userCredential UserCredential? @relation("StaffAuth", fields: [userId], references: [id], onDelete: Cascade)
  name  String  
  email String  @unique
  designation String 
  departmentId  String?  
  department  Department?  @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  role MemberRoleEnum @default(Staff)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  visits Visit[]
}

model RefreshToken {
  id  String @id @default(uuid())
  token String @unique
  userId  String?
  userCredentials UserCredential? @relation(fields: [userId], references: [id], onDelete: Cascade)
  systemId  String?
  systemCredentials SystemCredential? @relation(fields: [systemId], references: [id], onDelete: Cascade)
  expiryDate  DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}


model UserCredential{
  id String @id @default(uuid())
  orgId String?
  organization  Organization? @relation(fields: [orgId],references: [id], onDelete: Cascade)
  email String @unique
  password  String
  role AuthRoleEnum
  firstTimeLogin  Boolean? @default(true)
  accountStatus   AccountStatusEnum @default(Active) 
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  staff    Staff?  @relation("StaffAuth")
  refreshToken RefreshToken[]
  resetToken  ResetToken[]
}

model SystemCredential {
  id String @id @default(uuid())
  orgId String
  organization  Organization @relation(fields: [orgId],references: [id], onDelete: Cascade)
  email String @unique
  password  String
  secretCode  String
  activityStatus  LoginStatus @default(LoggedOut)
  role String @default("System")
  refreshToken  RefreshToken[]
  resetTokenSystem  ResetTokenSystem[]
}

model Department {
  id  String  @id @default(uuid())
  orgId String
  organization  Organization  @relation(fields: [orgId], references: [id], onDelete: Cascade)
  name  String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  staffs Staff[]
}

model ReasonOfVisit {
  id  String  @id @default(uuid())
  orgId String
  organization  Organization  @relation(fields: [orgId], references: [id], onDelete: Cascade)
  name  String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  vists Visit[]
}

model ResetToken {
  id String @id @default(uuid())
  token String @unique
  userId  String @unique
  userCredential  UserCredential  @relation(fields: [userId],  references: [id], onDelete: Cascade)
  
}

model ResetTokenSystem {
    id String @id @default(uuid())
  token String @unique
  systemId String @unique
  systemCredential SystemCredential @relation(fields: [systemId], references: [id], onDelete: Cascade)
}


enum MeetingStatus {
  ONGOING
  COMPLETED
}

enum AuthRoleEnum {
  Root
  SuperAdmin
  Admin
  Staff
}

enum MemberRoleEnum {
  SuperAdmin
  Admin
  Staff
}

enum AccountStatusEnum {
  Active
  Disabled
}

enum LoginStatus {
  LoggedIn
  LoggedOut
}